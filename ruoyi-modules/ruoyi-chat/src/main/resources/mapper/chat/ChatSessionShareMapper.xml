<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.ruoyi.chat.mapper.ChatSessionShareMapper">

    <resultMap type="org.ruoyi.chat.domain.entity.ChatSessionShare" id="ChatSessionShareResult">
        <id     property="id"           column="id"           />
        <result property="sessionId"    column="session_id"   />
        <result property="userId"       column="user_id"      />
        <result property="shareCode"    column="share_code"   />
        <result property="password"     column="password"     />
        <result property="expireTime"   column="expire_time"  />
        <result property="viewCount"    column="view_count"   />
        <result property="status"       column="status"       />
        <result property="createTime"   column="create_time"  />
        <result property="updateTime"   column="update_time"  />
    </resultMap>

    <sql id="selectChatSessionShareVo">
        select id, session_id, user_id, share_code, password, expire_time, view_count, status, create_time, update_time from chat_session_share
    </sql>

    <select id="selectByShareCode" parameterType="string" resultMap="ChatSessionShareResult">
        <include refid="selectChatSessionShareVo"/>
        where share_code = #{shareCode}
    </select>

    <select id="selectByUserId" parameterType="long" resultMap="ChatSessionShareResult">
        <include refid="selectChatSessionShareVo"/>
        where user_id = #{userId} order by create_time desc
    </select>

    <select id="selectBySessionId" parameterType="long" resultMap="ChatSessionShareResult">
        <include refid="selectChatSessionShareVo"/>
        where session_id = #{sessionId} and status = 1
    </select>

    <update id="incrementViewCount" parameterType="string">
        update chat_session_share set view_count = view_count + 1 where share_code = #{shareCode}
    </update>

</mapper>
